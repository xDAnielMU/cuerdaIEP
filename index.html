<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4F46E5">
    <title>Cancionero IEP</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="install-prompt" id="installPrompt">
        <span>üì± ¬°Instala esta app en tu dispositivo!</span>
        <button class="btn" onclick="instalarApp()">Instalar</button>
    </div>

    <div class="container">
        <header>
            <h1>üéµ Cancionero IEP</h1>
            <p class="subtitle">Repositorio de canciones para m√∫sicos cristianos</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="cambiarTab('canciones')">üìö Canciones</button>
            <button class="tab" onclick="cambiarTab('cultos')">üìã Cultos</button>
            <button class="tab" onclick="cambiarTab('agregar')">‚ûï Nueva Canci√≥n</button>
        </div>

        <div class="content">
            <!-- Secci√≥n Canciones -->
            <div id="canciones-section" class="section active">
                <input type="text" class="search-box" id="searchBox" placeholder="üîç Buscar canci√≥n..." oninput="buscarCanciones()">
                <button class="btn btn-secondary" onclick="sincronizarCanciones()" style="margin-bottom: 20px;">üîÑ Actualizar</button>
                <div id="cancionesList">
                    <div class="loading">Cargando canciones...</div>
                </div>
            </div>

            <!-- Secci√≥n Cultos -->
            <div id="cultos-section" class="section">
                <button class="btn" onclick="mostrarModalNuevoCulto()" style="margin-bottom: 20px;">‚ûï Nuevo Culto</button>
                <div id="cultosList">
                    <div class="loading">Cargando cultos...</div>
                </div>
            </div>

            <!-- Secci√≥n Agregar Canci√≥n -->
            <div id="agregar-section" class="section">
                <h2 style="margin-bottom: 20px;">Nueva Canci√≥n</h2>
                <form id="formNuevaCancion" onsubmit="guardarCancion(event)">
                    <div class="form-group">
                        <label>T√≠tulo de la canci√≥n *</label>
                        <input type="text" id="titulo" required>
                    </div>
                    <div class="form-group">
                        <label>Tonalidad *</label>
                        <select id="tonalidad" required>
                            <option value="">Seleccionar...</option>
                            <option value="C">C (Do)</option>
                            <option value="C#">C# (Do#)</option>
                            <option value="D">D (Re)</option>
                            <option value="D#">D# (Re#)</option>
                            <option value="E">E (Mi)</option>
                            <option value="F">F (Fa)</option>
                            <option value="F#">F# (Fa#)</option>
                            <option value="G">G (Sol)</option>
                            <option value="G#">G# (Sol#)</option>
                            <option value="A">A (La)</option>
                            <option value="A#">A# (La#)</option>
                            <option value="B">B (Si)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Autor</label>
                        <input type="text" id="autor">
                    </div>
                    
                    <!-- Panel de Acordes -->
                    <div class="acordes-panel">
                        <h3>üéº Insertar Acordes (Cifrado)</h3>
                        <div class="acordes-categorias">
                            <button type="button" class="categoria-btn active" onclick="cambiarCategoriaAcordes('mayores')">Mayores</button>
                            <button type="button" class="categoria-btn" onclick="cambiarCategoriaAcordes('menores')">Menores</button>
                            <button type="button" class="categoria-btn" onclick="cambiarCategoriaAcordes('septima')">S√©ptima</button>
                            <button type="button" class="categoria-btn" onclick="cambiarCategoriaAcordes('otros')">Otros</button>
                        </div>
                        
                        <div id="acordes-mayores" class="acordes-grid">
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('C')">C</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('C#')">C#</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('D')">D</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('D#')">D#</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('E')">E</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('F')">F</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('F#')">F#</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('G')">G</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('G#')">G#</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('A')">A</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('A#')">A#</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('B')">B</button>
                        </div>
                        
                        <div id="acordes-menores" class="acordes-grid" style="display: none;">
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Cm')">Cm</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('C#m')">C#m</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Dm')">Dm</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('D#m')">D#m</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Em')">Em</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Fm')">Fm</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('F#m')">F#m</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Gm')">Gm</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('G#m')">G#m</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Am')">Am</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('A#m')">A#m</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Bm')">Bm</button>
                        </div>
                        
                        <div id="acordes-septima" class="acordes-grid" style="display: none;">
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('C7')">C7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('D7')">D7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('E7')">E7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('F7')">F7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('G7')">G7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('A7')">A7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('B7')">B7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Cmaj7')">Cmaj7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Dmaj7')">Dmaj7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Emaj7')">Emaj7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Gmaj7')">Gmaj7</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Amaj7')">Amaj7</button>
                        </div>
                        
                        <div id="acordes-otros" class="acordes-grid" style="display: none;">
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Csus')">Csus</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Dsus')">Dsus</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Esus')">Esus</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Gsus')">Gsus</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Asus')">Asus</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Cdim')">Cdim</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Ddim')">Ddim</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Edim')">Edim</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Caug')">Caug</button>
                            <button type="button" class="acorde-btn" onclick="insertarAcorde('Daug')">Daug</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Letra con acordes *</label>
                        <textarea id="letra" required placeholder="Escribe la letra aqu√≠. Usa el panel de acordes para insertarlos.

Consejo: Escribe primero la letra completa, luego posiciona el cursor donde quieres un acorde y haz clic en el panel de acordes."></textarea>
                    </div>
                    <button type="submit" class="btn">üíæ Guardar Canci√≥n</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Ver Canci√≥n -->
    <div id="modalVerCancion" class="modal">
        <div class="modal-content">
            <h2 id="modalTitulo"></h2>
            <p id="modalInfo" style="color: #6b7280; margin-bottom: 20px;"></p>
            
            <!-- Controles de Transposici√≥n Mejorados -->
            <div class="transponer-controles">
                <h3>üéº Transponer Tonalidad</h3>
                <div class="transponer-botones">
                    <button type="button" class="btn-transponer" onclick="transponerRapido(-6)">-3 tonos</button>
                    <button type="button" class="btn-transponer" onclick="transponerRapido(-2)">-1 tono</button>
                    <button type="button" class="btn-transponer" onclick="transponerRapido(-1)">-¬Ω tono</button>
                    <button type="button" class="btn-transponer original" onclick="transponerRapido(0)">Original</button>
                    <button type="button" class="btn-transponer" onclick="transponerRapido(1)">+¬Ω tono</button>
                    <button type="button" class="btn-transponer" onclick="transponerRapido(2)">+1 tono</button>
                    <button type="button" class="btn-transponer" onclick="transponerRapido(6)">+3 tonos</button>
                </div>
                <p class="transponer-info">Tonalidad actual: <strong id="tonalidadActual">-</strong></p>
            </div>
            
            <div id="modalLetra" class="letra-display"></div>
            
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="editarCancionActual()">‚úèÔ∏è Editar</button>
                <button class="btn btn-danger" onclick="eliminarCancionActual()">üóëÔ∏è Eliminar</button>
                <button class="btn" onclick="cerrarModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Culto -->
    <div id="modalNuevoCulto" class="modal">
        <div class="modal-content">
            <h2>Nuevo Culto</h2>
            <form id="formNuevoCulto" onsubmit="guardarCulto(event)">
                <div class="form-group">
                    <label>Nombre del culto *</label>
                    <input type="text" id="nombreCulto" required placeholder="Ej: Culto Domingo Ma√±ana">
                </div>
                <div class="form-group">
                    <label>Fecha *</label>
                    <input type="date" id="fechaCulto" required>
                </div>
                <div class="form-group">
                    <label>Hora *</label>
                    <input type="time" id="horaCulto" required>
                </div>
                <div class="form-group">
                    <label>Notas</label>
                    <textarea id="notasCulto" placeholder="Notas adicionales..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn">üíæ Crear Culto</button>
                    <button type="button" class="btn" onclick="cerrarModalCulto()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>