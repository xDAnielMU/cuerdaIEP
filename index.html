<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FF6B35">
    <title>Cancionero IEP</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- HEADER PRINCIPAL -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-container">
                <div class="logo-icon">üéµ</div>
            </div>
            <h1 class="app-title">CANCIONERO IEP</h1>
            <button class="header-btn" onclick="instalarApp()" id="installBtn">
                <span>üîß</span>
            </button>
        </div>
    </header>

    <!-- BARRA DE B√öSQUEDA -->
    <div class="search-container">
        <div class="search-wrapper">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" id="searchBox" placeholder="Buscar canciones..." oninput="buscarCanciones()">
        </div>
        <button class="add-btn" onclick="resetFormularioNuevaCancion(); cambiarTab('agregar')">
            <span class="add-icon">+</span>
        </button>
    </div>

    <!-- BOT√ìN SELECCIONAR CANCIONES -->
    <div class="selection-controls">
        <button class="btn-seleccionar" id="btnSeleccionar" onclick="activarModoSeleccion()">
            <span>‚òëÔ∏è</span> Seleccionar Canciones
        </button>
        
        <div class="botones-accion-seleccion" id="botonesAccionSeleccion">
            <span class="contador-seleccionadas" id="contadorSeleccionadas">0 seleccionadas</span>
            <button class="btn-asignar-culto" onclick="mostrarModalAsignarCulto()">
                <span>üìã</span> Asignar a Culto
            </button>
            <button class="btn-cancelar-seleccion" onclick="desactivarModoSeleccion()">
                <span>‚úï</span> Cancelar
            </button>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container">
        <!-- SECCI√ìN CANCIONES -->
        <div id="canciones-section" class="section active">
            <div id="cancionesList">
                <div class="loading">Cargando canciones...</div>
            </div>
        </div>

        <!-- SECCI√ìN CULTOS -->
        <div id="cultos-section" class="section">
            <div class="cultos-header">
                <button class="back-btn" onclick="cambiarTab('canciones')">
                    <span>‚Üê</span> Volver al Men√∫ Principal
                </button>
                <h2>Cultos Programados</h2>
            </div>
            <div id="cultosList">
                <div class="loading">Cargando cultos...</div>
            </div>
        </div>

        <!-- SECCI√ìN AGREGAR CANCI√ìN -->
        <div id="agregar-section" class="section">
            <div class="form-header">
                <button class="back-btn" onclick="cambiarTab('canciones')">
                    <span>‚Üê</span> Volver
                </button>
                <h2>Nueva Canci√≥n</h2>
            </div>
            
            <form id="formNuevaCancion" onsubmit="guardarCancion(event)" class="song-form">
                <div class="form-group">
                    <label>T√≠tulo *</label>
                    <input type="text" id="titulo" required class="form-input">
                </div>
                
                <div class="form-group">
                    <label>Artista</label>
                    <input type="text" id="autor" class="form-input">
                </div>
                
                <div class="form-group">
                    <label>Tonalidad Original</label>
                    <select id="tonalidad" required class="form-select">
                        <option value="Bm">Bm</option>
                        <option value="C">C</option>
                        <option value="C#">C#</option>
                        <option value="D">D</option>
                        <option value="D#">D#</option>
                        <option value="E">E</option>
                        <option value="Em">Em</option>
                        <option value="F">F</option>
                        <option value="F#">F#</option>
                        <option value="G">G</option>
                        <option value="G#">G#</option>
                        <option value="A">A</option>
                        <option value="A#">A#</option>
                        <option value="B">B</option>
                    </select>
                </div>

                <!-- GRILLA DE ACORDES -->
                <div class="chords-section">
                    <div class="chords-grid-main">
                        <button type="button" class="chord-btn-main" onclick="mostrarVariantes('C')">C</button>
                        <button type="button" class="chord-btn-main" onclick="mostrarVariantes('D')">D</button>
                        <button type="button" class="chord-btn-main" onclick="mostrarVariantes('E')">E</button>
                        <button type="button" class="chord-btn-main" onclick="mostrarVariantes('F')">F</button>
                        <button type="button" class="chord-btn-main" onclick="mostrarVariantes('G')">G</button>
                        <button type="button" class="chord-btn-main" onclick="mostrarVariantes('A')">A</button>
                        <button type="button" class="chord-btn-main" onclick="mostrarVariantes('B')">B</button>
                    </div>
                    
                    <!-- Variantes de acordes -->
                    <div class="chords-variants" id="variantesAcordes"></div>
                </div>

                <div class="form-group">
                    <label>Letra con Acordes * <span class="help-icon" title="Usa [Acorde] para insertar acordes. Ej: [Am], [G7], [Cmaj7]">?</span></label>
                    <textarea id="letra" required class="form-textarea" placeholder="Si fu√© en la cruz, que yo encontr√©&#10;&#10;La paz y el gozo que llena&#10;&#10;C# La gracia que lo cambi√≥ todo"></textarea>
                    <small class="form-hint">Usa [Acorde] para insertar acordes. Ej: [Am]</small>
                </div>
                
                <div class="form-actions-bottom">
                    <button type="submit" class="btn-save">
                        <span>üíæ</span> Guardar
                    </button>
                    <button type="button" class="btn-cancel" onclick="cambiarTab('canciones')">
                        <span>‚úï</span> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL VER CANCI√ìN -->
    <div id="modalVerCancion" class="modal">
        <div class="modal-content-song">
            <!-- Header del Modal -->
            <div class="modal-song-header">
                <button class="back-modal-btn" onclick="cerrarModal()">
                    <span>‚Üê</span> Volver
                </button>
                <div class="song-info-header">
                    <h2 id="modalTitulo">Despacito</h2>
                    <div class="song-meta">
                        <span id="modalAutor">üë§ Luis Fonsi</span>
                        <span id="modalGenero">üéµ Pop</span>
                    </div>
                </div>
                <button class="edit-btn-header" onclick="editarCancionActual()">
                    <span>‚úèÔ∏è</span>
                </button>
                <button class="delete-btn-header" onclick="eliminarCancionActual()">
                    <span>üóëÔ∏è</span>
                </button>
            </div>

            <!-- Controles de tono -->
            <div class="tone-controls">
                <button class="tone-btn tone-down" onclick="transponerRapido(-1)">‚àí</button>
                <div class="tone-display">
                    <span class="tone-label">TONO</span>
                    <span class="tone-value" id="tonalidadActual">Bm</span>
                </div>
                <button class="tone-btn tone-up" onclick="transponerRapido(1)">+</button>
            </div>

            <!-- Controles de tama√±o de texto -->
            <div class="text-controls">
                <button class="text-btn text-decrease" onclick="decreaseFontSize()">
                    <span style="font-size: 14px;">aA</span>
                </button>
                <button class="text-btn text-increase" onclick="increaseFontSize()">
                    <span style="font-size: 20px;">aA</span>
                </button>
                <button class="text-btn text-reset" onclick="resetFontSize()">‚Ü∫</button>
            </div>
            <!-- Controles adicionales -->
            <div class="additional-controls">
                <button class="control-btn btn-fullscreen" onclick="activarPantallaCompleta()" title="Pantalla completa">
                    <span>‚õ∂</span> Pantalla Completa
                </button>
                <button class="control-btn btn-share" onclick="compartirPorWhatsApp()" title="Compartir por WhatsApp">
                    <span>üì±</span> Compartir
                </button>
            </div>

            <!-- Bot√≥n para salir de pantalla completa -->
            <div class="exit-fullscreen-btn" onclick="salirPantallaCompleta()">
                <span>‚úï</span> Salir de Pantalla Completa
            </div>

            <!-- Letra de la canci√≥n -->
            <div class="song-lyrics-container">
                <div id="modalLetra" class="song-lyrics"></div>
            </div>
        </div>
    </div>

    <!-- MODAL DETALLE CULTO -->
    <div id="modalDetalleCulto" class="modal">
        <div class="modal-content">
            <div class="modal-header-simple">
                <button class="back-btn" onclick="cerrarModalDetalleCulto()">
                    <span>‚Üê</span> Volver
                </button>
                <h2 id="detalleCultoTitulo">Culto Domingo</h2>
            </div>
            
            <div class="culto-detalle-info">
                <p id="detalleCultoFecha">üìÖ 2024-01-15 | ‚è∞ 10:00</p>
                <p><strong>Notas:</strong> <span id="detalleCultoNotas">Sin notas</span></p>
            </div>
            
            <h3 style="margin: 20px 0 15px 0; color: var(--text-primary);">Canciones del Culto</h3>
            <div id="listaCancionesCulto" class="lista-canciones-culto"></div>
        </div>
    </div>

    <!-- MODAL NUEVO CULTO -->
    <div id="modalNuevoCulto" class="modal">
        <div class="modal-content">
            <div class="modal-header-simple">
                <h2>Nuevo Culto</h2>
                <button class="close-btn" onclick="cerrarModalCulto()">‚úï</button>
            </div>
            <form id="formNuevoCulto" onsubmit="guardarCulto(event)">
                <div class="form-group">
                    <label>Nombre del culto *</label>
                    <input type="text" id="nombreCulto" required class="form-input" placeholder="Ej: Culto Domingo Ma√±ana">
                </div>
                <div class="form-group">
                    <label>Fecha *</label>
                    <input type="date" id="fechaCulto" required class="form-input">
                </div>
                <div class="form-group">
                    <label>Hora *</label>
                    <input type="time" id="horaCulto" required class="form-input">
                </div>
                <div class="form-group">
                    <label>Notas</label>
                    <textarea id="notasCulto" class="form-textarea" placeholder="Notas adicionales..."></textarea>
                </div>
                <div class="form-actions-modal">
                    <button type="submit" class="btn-save">Crear Culto</button>
                    <button type="button" class="btn-cancel" onclick="cerrarModalCulto()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL ASIGNAR CANCIONES A CULTO -->
    <div id="modalAsignarCulto" class="modal">
        <div class="modal-content">
            <div class="modal-header-simple">
                <h2>Asignar Canciones a Culto</h2>
                <button class="close-btn" onclick="cerrarModalAsignarCulto()">‚úï</button>
            </div>
            <form onsubmit="asignarCancionesACulto(event)">
                <div class="form-group">
                    <label>Selecciona el Culto *</label>
                    <select id="cultoSelect" required class="form-select">
                        <option value="">Cargando cultos...</option>
                    </select>
                </div>
                <div class="form-actions-modal">
                    <button type="submit" class="btn-save">Asignar Canciones</button>
                    <button type="button" class="btn-cancel" onclick="cerrarModalAsignarCulto()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- BOTONES FLOTANTES INFERIORES -->
    <div class="bottom-actions">
        <button class="bottom-btn btn-cultos" onclick="cambiarTab('cultos')">
            <span class="bottom-btn-text">VER CULTOS</span>
        </button>
        <button class="bottom-btn btn-create-culto" onclick="mostrarModalNuevoCulto()">
            <span class="bottom-btn-text">CREAR CULTO</span>
        </button>
    </div>

    <script src="app.js"></script>
</body>
</html>